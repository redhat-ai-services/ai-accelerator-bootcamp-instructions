# Disconnected OpenShift Cluster 

## Spin Up Disconnected Cluster Environment

Navigate to https://demo.redhat.com/catalog?search=disconnected&item=babylon-catalog-prod%2Fsandboxes-gpte.ocp4-disconnected.prod and order 1 of the OpenShift Disconnected Workshop. 

[.bordershadow]
image::disconnected-cluster/workshop.png[Request Disconnected OpemnShift Cluster]

Follow the steps in the workshop documentation to set up the disconnected cluster. 

Login to AWS Console:

[.bordershadow]
image::disconnected-cluster/AWS-login.png[AWS Login Details]

View instances on AWS console: 

[.bordershadow]
image::disconnected-cluster/instances.png[AWS Instances]

## Increase Volume for Jump instance (low-side) to 500GiB

Select jump (low side) instance, View Storage details for jump instance. 

image::disconnected-cluster/instance-storage.png[Storage Details]

Select Actions -> Modify Volume

[.bordershadow]
image::disconnected-cluster/add-storage.png[Modify Storage]

Update Size to 500GiB and click Modify. 

image::disconnected-cluster/modify-storage.png[Modify Storage]

## Increase Volume for High-Side instance to 600GiB

We have to repeat the same steps for highside instance. 
* Select high-side instance, View Storage details for high-side instance. * Select Actions -> Modify Volume
* Update Size to 600GiB and click Modify. 

image::disconnected-cluster/storage-highside.png[Modify Storage]


## Update imageset-config.yaml

Replace the content for imageset-config.yaml to include all the operators and images required for AI-Accelerator Bootcamp. 

.imageset-config.yaml
[source, sh]
----
kind: ImageSetConfiguration
apiVersion: mirror.openshift.io/v1alpha2
storageConfig:
  local:
    path: ./
mirror:
  platform:
    channels:
    - name: stable-4.14
      type: ocp
      minVersion: 4.14.19
      maxVersion: 4.14.20

  operators:
  - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.14
    packages:
    - name: web-terminal
      channels:
      - name: fast
    - name: openshift-pipelines-operator-rh
      channels:
      - name: latest
    - name: serverless-operator
      channels:
      - name: stable
    - name: servicemeshoperator
      channels:
      - name: stable
    - name: authorino-operator
      channels:
      - name: tech-preview-v1
    - name: openshift-gitops-operator
      channels:
      - name: latest
    - name: rhods-operator
      channels:
      - name: fast
        minVersion: 2.11.0
        maxVersion: 2.11.0

  additionalImages:
    - name: quay.io/modh/odh-generic-data-science-notebook@sha256:465e81c69c891565b979668b84adcf0c645b1ed99e1bf107474ef6bb56090027
    - name: quay.io/modh/odh-generic-data-science-notebook@sha256:bb33abc67af1328d3b32899f58bcdc0cf1681605e1b5da57f8fe8da81523a9bd
    - name: quay.io/modh/odh-generic-data-science-notebook@sha256:e2cab24ebe935d87f7596418772f5a97ce6a2e747ba0c1fd4cec08a728e99403
    - name: quay.io/modh/odh-generic-data-science-notebook@sha256:76e6af79c601a323f75a58e7005de0beac66b8cccc3d2b67efb6d11d85f0cfa1
    - name: quay.io/modh/odh-minimal-notebook-container@sha256:39068767eebdf3a127fe8857fbdaca0832cdfef69eed6ec3ff6ed1858029420f
    - name: quay.io/modh/odh-minimal-notebook-container@sha256:eec50e5518176d5a31da739596a7ddae032d73851f9107846a587442ebd10a82
    - name: quay.io/modh/odh-minimal-notebook-container@sha256:07d509dc2aa166e21e8b9ef2cd88d0863140fe4bf2169be2c4be44a62aa5d097
    - name: quay.io/modh/odh-minimal-notebook-container@sha256:f224d87854de9b8879022cf47b432cc9a4777f9d164b8341c20d0046c0182194
    - name: quay.io/opendatahub/odh-notebook-controller:stable
    - name: docker.io/alpine/git:2.43.0
    - name: quay.io/minio/minio:RELEASE.2024-05-07T06-41-25Z
    - name: registry.redhat.io/rhel8/postgresql-12:latest
    - name: gcr.io/kubebuilder/kube-rbac-proxy:v0.13.1
    - name: quay.io/rhpds/gitea:1.20.0
    - name: quay.io/rhpds/gitea-operator:v2.0.7
    - name: quay.io/rhpds/gitea-operator-bundle:v2.0.7
    - name: quay.io/rhpds/gitea-catalog:latest
    - name: registry.redhat.io/openshift4/ose-cli:latest
    - name: registry.redhat.io/rhel8/support-tools:latest
    - name: quay.io/integreatly/prometheus-blackbox-exporter@sha256:35b9d2c1002201723b7f7a9f54e9406b2ec4b5b0f73d114f47c70e15956103b5
    - name: quay.io/modh/caikit-nlp@sha256:0cde6c26e02ec398aea959a1a1bcdc615b86821adb41989e81d03de01124545c
    - name: quay.io/modh/caikit-tgis-serving@sha256:4e907ce35a3767f5be2f3175a1854e8d4456c43b78cf3df4305bceabcbf0d6e2
    - name: quay.io/modh/codeserver@sha256:cf69c38ccc64f79572805e51c2f1f9000e44b26033f577eb8cd2957a32a997c3
    - name: quay.io/modh/codeserver@sha256:d0b809b14ccb0fe8df98c0a20a7cdc1fe868beb31f837bc440cc641d5a3be5c9
    - name: quay.io/modh/cuda-notebooks@sha256:00c53599f5085beedd0debb062652a1856b19921ccf59bd76134471d24c3fa7d
    - name: quay.io/modh/cuda-notebooks@sha256:500029c74d8e54a9cf29b900059aa33f1b9582927bb3628ebb8891d3efaf6896
    - name: quay.io/modh/cuda-notebooks@sha256:6fadedc5a10f5a914bb7b27cd41bc644392e5757ceaf07d930db884112054265
    - name: quay.io/modh/cuda-notebooks@sha256:81622e37771d341e119a2e55f09ffaf7837ad73af3602d2817d54ed53ea65665
    - name: quay.io/modh/cuda-notebooks@sha256:88d80821ff8c5d53526794261d519125d0763b621d824f8c3222127dab7b6cc8
    - name: quay.io/modh/cuda-notebooks@sha256:eb02f5fc5f18697fb36b9c3837183fd22c4ac5a9e5afa377d132e73bff16dc8d
    - name: quay.io/modh/cuda-notebooks@sha256:f2282968cd8aa26b362cccfa2a880e30ac2661fa1cdc13118623758e205776b0
    - name: quay.io/modh/cuda-notebooks@sha256:f6cdc993b4d493ffaec876abb724ce44b3c6fc37560af974072b346e45ac1a3b
    - name: quay.io/modh/kserve-agent@sha256:7c5557fe946eef95ea33ab9ddf5f88da62ee7a0af46348271549ab86ca351296
    - name: quay.io/modh/kserve-controller@sha256:78bc9b598642a679818e347f389b65960917965086a7cac3de08f620f2b70536
    - name: quay.io/modh/kserve-router@sha256:5e8e14e885535d0318c687a85b125ffc7b8eb14e3e95fdb8e4eb3bfbb767d0b0
    - name: quay.io/modh/kserve-storage-initializer@sha256:8b3c5b7388dc75f64e82b4dfdc1b881e7e169a50a4be6a08a1b49cbbf92ca749
    - name: quay.io/modh/odh-anaconda-notebook@sha256:380c07bf79f5ec7d22441cde276c50b5eb2a459485cde05087837639a566ae3d
    - name: quay.io/modh/odh-generic-data-science-notebook@sha256:465e81c69c891565b979668b84adcf0c645b1ed99e1bf107474ef6bb56090027
    - name: quay.io/modh/odh-generic-data-science-notebook@sha256:76e6af79c601a323f75a58e7005de0beac66b8cccc3d2b67efb6d11d85f0cfa1
    - name: quay.io/modh/odh-generic-data-science-notebook@sha256:bb33abc67af1328d3b32899f58bcdc0cf1681605e1b5da57f8fe8da81523a9bd
    - name: quay.io/modh/odh-generic-data-science-notebook@sha256:e2cab24ebe935d87f7596418772f5a97ce6a2e747ba0c1fd4cec08a728e99403
    - name: quay.io/modh/odh-habana-notebooks@sha256:213e49f1aed8a36b86373f2cf15a6a854b9393684a5f3073195a7896d6b91365
    - name: quay.io/modh/odh-habana-notebooks@sha256:30bedcd9b007d087ec06b272b54ce552572e922f08810537def8724f98a1d541
    - name: quay.io/modh/odh-minimal-notebook-container@sha256:07d509dc2aa166e21e8b9ef2cd88d0863140fe4bf2169be2c4be44a62aa5d097
    - name: quay.io/modh/odh-minimal-notebook-container@sha256:39068767eebdf3a127fe8857fbdaca0832cdfef69eed6ec3ff6ed1858029420f
    - name: quay.io/modh/odh-minimal-notebook-container@sha256:eec50e5518176d5a31da739596a7ddae032d73851f9107846a587442ebd10a82
    - name: quay.io/modh/odh-minimal-notebook-container@sha256:f224d87854de9b8879022cf47b432cc9a4777f9d164b8341c20d0046c0182194
    - name: quay.io/modh/odh-pytorch-notebook@sha256:4d947ed12e72f77084a789c70fc6bda5898356332ecc0b044be9599aff57eec1
    - name: quay.io/modh/odh-pytorch-notebook@sha256:97b346197e6fc568c2eb52cb82e13a206277f27c21e299d1c211997f140f638b
    - name: quay.io/modh/odh-pytorch-notebook@sha256:b68e0192abf7d46c8c6876d0819b66c6a2d4a1e674f8893f8a71ffdcba96866c
    - name: quay.io/modh/odh-pytorch-notebook@sha256:cc9bd664e734467d74f8a3b5cb2d603e5b488620addf30fb67cebfa654ed41a9
    - name: quay.io/modh/odh-trustyai-notebook@sha256:0d09325fd35dafbc2b202a7aafa03ab67d1730545f63fecbea43564f6214bf41
    - name: quay.io/modh/odh-trustyai-notebook@sha256:8c5e653f6bc6a2050565cf92f397991fbec952dc05cdfea74b65b8fd3047c9d4
    - name: quay.io/modh/odh-trustyai-notebook@sha256:a2aaaf40fffcfa890e21baac0559325dd82a661d38e3a4626a62b3609ef45ff9
    - name: quay.io/modh/openvino_model_server@sha256:9ccb29967f39b5003cf395cc686a443d288869578db15d0d37ed8ebbeba19375
    - name: quay.io/modh/runtime-images@sha256:0a3c137492e66c5fac89786f90dbbfdfd3eecd8d9c0e4e890aeeb8f558cd731d
    - name: quay.io/modh/runtime-images@sha256:1711dfaeb5fea393ebe09dc957fcf36720ff2859c3afc47fe4e2110b68bc918f
    - name: quay.io/modh/runtime-images@sha256:28f28de1b5f3d9e1f75ccf69604003f2366e0b9e138b8eb98212110f40195b77
    - name: quay.io/modh/runtime-images@sha256:54cc74e9dc65c51c839fde9c25c23378c5157fee0ce85b1b61623b9c9563da98
    - name: quay.io/modh/runtime-images@sha256:90e394f5a379c24176b1efee6c84b83866314cafd539a66cd58544f24def84f9
    - name: quay.io/modh/runtime-images@sha256:abd44461b3d9309ed5517aa4e9e124652ff8df255c4d481b9d3d37841c36e4ac
    - name: quay.io/modh/runtime-images@sha256:e750b6b183ad987be1f7bfb6b814e36d0a79e393a3d66d0294686f14dfea1644
    - name: quay.io/modh/runtime-images@sha256:e802af94ca7daf747bf0af27aa5b66745b2f07e0a2c3d9437036bffa84a256b4
    - name: quay.io/modh/text-generation-inference@sha256:294f07b2a94a223a18e559d497a79cac53bf7893f36cfc6c995475b6e431bcfe
    - name: quay.io/modh/vllm@sha256:e14cae9114044dc9fe71e99c3db692a892b2caffe04283067129ab1093a7bde5
    - name: quay.io/modh/caikit-tgis-serving@sha256:4e907ce35a3767f5be2f3175a1854e8d4456c43b78cf3df4305bceabcbf0d6e2
    - name: quay.io/modh/caikit-nlp@sha256:0cde6c26e02ec398aea959a1a1bcdc615b86821adb41989e81d03de01124545c
    - name: quay.io/modh/text-generation-inference@sha256:294f07b2a94a223a18e559d497a79cac53bf7893f36cfc6c995475b6e431bcfe
    - name: quay.io/modh/openvino_model_server@sha256:9ccb29967f39b5003cf395cc686a443d288869578db15d0d37ed8ebbeba19375
    - name: quay.io/modh/vllm@sha256:e14cae9114044dc9fe71e99c3db692a892b2caffe04283067129ab1093a7bde5
    - name: quay.io/modh/fms-hf-tuning@sha256:4ab6b17d9ef74c092fe8ff24b505ecad41a7d231c470bc4ee0cee23080976b08
    - name: quay.io/rhoai/ray@sha256:859f5c41d41bad1935bce455ad3732dff9d4d4c342b7155a7cd23809e85698ab
    - name: quay.io/modh/must-gather@sha256:a57ac193de3a7e258d22eda528c598ef6ffe52725b09f226e0cc948b3b75bfb3

  helm: {}
----

oc-mirror command takes about 4 hours to complete. 

.install-config.yaml
[source, sh]
----
apiVersion: v1
metadata:
  name: disco
baseDomain: lab
compute:
- architecture: amd64
  hyperthreading: Enabled
  name: worker
  replicas: 3
controlPlane:
  architecture: amd64
  hyperthreading: Enabled
  name: master
  replicas: 5
networking:
  clusterNetwork:
  - cidr: 10.128.0.0/14
    hostPrefix: 23
  machineNetwork:
  - cidr: 10.0.0.0/16
  networkType: OVNKubernetes
  serviceNetwork:
  - 172.30.0.0/16
platform:
  aws:
    region: us-east-2
    subnets:
    - subnet-079ac31e791746995
publish: Internal
additionalTrustBundlePolicy: Always

----

