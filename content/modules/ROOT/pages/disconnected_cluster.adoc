# Disconnected OpenShift Cluster 

## Spin Up Disconnected Cluster Environment

Navigate to https://demo.redhat.com/catalog?search=disconnected&item=babylon-catalog-prod%2Fsandboxes-gpte.ocp4-disconnected.prod and order 1 of the OpenShift Disconnected Workshop. 

[.bordershadow]
image::disconnected-cluster/workshop.png[Request Disconnected OpemnShift Cluster]

Follow the steps in the workshop documentation to set up the disconnected cluster. 

Login to AWS Console:

[.bordershadow]
image::disconnected-cluster/AWS-login.png[AWS Login Details]

View instances on AWS console: 

[.bordershadow]
image::disconnected-cluster/instances.png[AWS Instances]

## Increase Volume for Jump instance (low-side) to 500GiB

Select jump (low side) instance, View Storage details for jump instance. 

image::disconnected-cluster/instance-storage.png[Storage Details]

Select Actions -> Modify Volume

[.bordershadow]
image::disconnected-cluster/add-storage.png[Modify Storage]

Update Size to 500GiB and click Modify. 

image::disconnected-cluster/modify-storage.png[Modify Storage]

## Increase Volume for High-Side instance to 600GiB

We have to repeat the same steps for highside instance. 
* Select high-side instance, View Storage details for high-side instance. * Select Actions -> Modify Volume
* Update Size to 600GiB and click Modify. 

image::disconnected-cluster/storage-highside.png[Modify Storage]


## Update imageset-config.yaml

Replace the content for imageset-config.yaml to include all the operators and images required for AI-Accelerator Bootcamp. 

.imageset-config.yaml
[source, sh]
----
kind: ImageSetConfiguration
apiVersion: mirror.openshift.io/v1alpha2
storageConfig:
  local:
    path: ./
mirror:
  platform:
    channels:
    - name: stable-4.14
      type: ocp
      minVersion: 4.14.19
      maxVersion: 4.14.20

  operators:
  - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.14
    packages:
    - name: web-terminal
      channels:
      - name: fast
    - name: openshift-pipelines-operator-rh
      channels:
      - name: latest
    - name: serverless-operator
      channels:
      - name: stable
    - name: servicemeshoperator
      channels:
      - name: stable
    - name: authorino-operator
      channels:
      - name: tech-preview-v1
    - name: openshift-gitops-operator
      channels:
      - name: latest
    - name: rhods-operator
      channels:
      - name: stable
        minVersion: 2.13.0
        maxVersion: 2.13.0

  additionalImages:
    - name: quay.io/integreatly/prometheus-blackbox-exporter@sha256:35b9d2c1002201723b7f7a9f54e9406b2ec4b5b0f73d114f47c70e15956103b5
    - name: quay.io/modh/caikit-nlp@sha256:9bfb4a233aed39b3218471bc9975c6618eb42da22c8e2587c14f99aeb32dbd12
    - name: quay.io/modh/caikit-tgis-serving@sha256:3a2477e143c494280a81e50c31adb54fc9f2fd0a84dde3b31cf9f6929fb2d1f9
    - name: quay.io/modh/codeserver@sha256:4b6b563e75f9e642bac9f21c4a2d8d72d77923fc391dd5dc985d4489c7258ef5
    - name: quay.io/modh/codeserver@sha256:b1a048f3711149e36a89e0eda1a5601130fb536ecc0aabae42ab6e4d26977354
    - name: quay.io/modh/cuda-notebooks@sha256:00c53599f5085beedd0debb062652a1856b19921ccf59bd76134471d24c3fa7d
    - name: quay.io/modh/cuda-notebooks@sha256:3da74d732d158b92eaada0a27fb7067fa18c8bde5033c672e23caed0f21d6481
    - name: quay.io/modh/cuda-notebooks@sha256:6fadedc5a10f5a914bb7b27cd41bc644392e5757ceaf07d930db884112054265
    - name: quay.io/modh/cuda-notebooks@sha256:88d80821ff8c5d53526794261d519125d0763b621d824f8c3222127dab7b6cc8
    - name: quay.io/modh/cuda-notebooks@sha256:a484d344f6feab25e025ea75575d837f5725f819b50a6e3476cef1f9925c07a5
    - name: quay.io/modh/cuda-notebooks@sha256:ce86467ff0768a47ca6adb5268f29c9986a5925020a7cd9e951fcd6347c977ad
    - name: quay.io/modh/cuda-notebooks@sha256:d8295bcf45a6a522f78c07dc62634a7775fc434621973bd81db243a5a63a1ffa
    - name: quay.io/modh/cuda-notebooks@sha256:f6cdc993b4d493ffaec876abb724ce44b3c6fc37560af974072b346e45ac1a3b
    - name: quay.io/modh/kserve-agent@sha256:471991bb24923b0a86df77deee567588b390ef044edb0b10a72b516ee731b25f
    - name: quay.io/modh/kserve-controller@sha256:8148a465ff199226dd8c355f25a60eb5ab9154e5a14deafe6273641366f7e518
    - name: quay.io/modh/kserve-router@sha256:7bd11bb1211c138ab6570fd38d6c739c8c2a1c360c75cd938041d9ce9d28611c
    - name: quay.io/modh/kserve-storage-initializer@sha256:8be80149e2a41c89bae4ef69a2d18333e2f16afea559c19cdcb664594898a557
    - name: quay.io/modh/odh-anaconda-notebook@sha256:380c07bf79f5ec7d22441cde276c50b5eb2a459485cde05087837639a566ae3d
    - name: quay.io/modh/odh-generic-data-science-notebook@sha256:39853fd63555ebba097483c5ac6a375d6039e5522c7294684efb7966ba4bc693
    - name: quay.io/modh/odh-generic-data-science-notebook@sha256:76e6af79c601a323f75a58e7005de0beac66b8cccc3d2b67efb6d11d85f0cfa1
    - name: quay.io/modh/odh-generic-data-science-notebook@sha256:d81e47fa2f5656042748cf2cd1d97033f58d6dd707667ff0e25aa969959e56a7
    - name: quay.io/modh/odh-generic-data-science-notebook@sha256:e2cab24ebe935d87f7596418772f5a97ce6a2e747ba0c1fd4cec08a728e99403
    - name: quay.io/modh/odh-habana-notebooks@sha256:4317c67037e1150fc62f8c688696d3210e4151d6ed4415dd969e60850e871c64
    - name: quay.io/modh/odh-habana-notebooks@sha256:6923f084d66bf6b9b2bf87edfb9b3c1f8f9a5f2005482fbcc060c9872db8d28a
    - name: quay.io/modh/odh-minimal-notebook-container@sha256:39068767eebdf3a127fe8857fbdaca0832cdfef69eed6ec3ff6ed1858029420f
    - name: quay.io/modh/odh-minimal-notebook-container@sha256:4ba72ae7f367a36030470fa4ac22eca0aab285c7c3f1c4cdcc33dc07aa522143
    - name: quay.io/modh/odh-minimal-notebook-container@sha256:eec50e5518176d5a31da739596a7ddae032d73851f9107846a587442ebd10a82
    - name: quay.io/modh/odh-minimal-notebook-container@sha256:eed810f98057c391799db3feea0a61baaaa6b154660d32d1737980020e335dc3
    - name: quay.io/modh/odh-pytorch-notebook@sha256:806e6524cb46bcbd228e37a92191c936bb4c117100fc731604e19df80286b19d
    - name: quay.io/modh/odh-pytorch-notebook@sha256:8e6f96724b9d9f9e56f680e19607646b9c51467ef2e38df451155877326ecce9
    - name: quay.io/modh/odh-pytorch-notebook@sha256:97b346197e6fc568c2eb52cb82e13a206277f27c21e299d1c211997f140f638b
    - name: quay.io/modh/odh-pytorch-notebook@sha256:b68e0192abf7d46c8c6876d0819b66c6a2d4a1e674f8893f8a71ffdcba96866c
    - name: quay.io/modh/odh-trustyai-notebook@sha256:09082398dabbb9ba675f5245866b8a91025a74a75321609379def2c3007baaf7
    - name: quay.io/modh/odh-trustyai-notebook@sha256:8c5e653f6bc6a2050565cf92f397991fbec952dc05cdfea74b65b8fd3047c9d4
    - name: quay.io/modh/odh-trustyai-notebook@sha256:fe883d8513c5d133af1ee3f7bb0b7b37d3bada8ae73fc7209052591d4be681c0
    - name: quay.io/modh/openvino_model_server@sha256:9086c1ba1ba30d358194c534f0563923aab02d03954e43e9f3647136b44a5daf
    - name: quay.io/modh/runtime-images@sha256:188ceefd0b7bb085328771dd11fb385ff983500b03fb66c9d754b8f6a4d9050a
    - name: quay.io/modh/runtime-images@sha256:19ef5491d4dc059bbc93bb9e4e2579c5729ae65463771e32f325e3f925ac8363
    - name: quay.io/modh/runtime-images@sha256:318396e737a2f014d1d46eadff39a47829f67ff749d389d75a289835bfa86c98
    - name: quay.io/modh/runtime-images@sha256:59c11378220886e02be05ba1c27330e8445e7871d1bcd0aa02e1b42b648381c1
    - name: quay.io/modh/runtime-images@sha256:8a4afcaab06439abcfa66420d6be905d7fe2220b749eefd9e3bbfbe4884e9d1e
    - name: quay.io/modh/runtime-images@sha256:a2f09f6095e3ba6bc6cf3b8d702fcdd4814f9d4c43e076795bfcdeb334ef9978
    - name: quay.io/modh/runtime-images@sha256:df1adec7e0623afd07fbe2d6fd6f759800d93c136c33a5b322ed347cbbbd70aa
    - name: quay.io/modh/runtime-images@sha256:e46fd90085206b1d77a18635db5784bca1f34e69c87ffbc13c6bffd65fd3c9d5
    - name: quay.io/modh/text-generation-inference@sha256:792e1500548c293eae428cf079fce836e68fbf7d4f7a53b5958c5158a70edfbf
    - name: quay.io/modh/vllm@sha256:2e7f97b69d6e0aa7366ee6a841a7e709829136a143608bee859b1fe700c36d31
    - name: quay.io/modh/fms-hf-tuning@sha256:eee08ba5bb14ead4e031408fcb2334d8da817dec3be7df8d2fc8b1a3d3bb9c1d
    - name: quay.io/modh/must-gather@sha256:9d5988f45c3b00ec7fbbe7a8a86cc149a2768c9c47e207694fdb6e87ef44adf3

  helm: {}
----

oc-mirror command takes about 4 hours to complete. 

.install-config.yaml
[source, sh]
----
apiVersion: v1
metadata:
  name: disco
baseDomain: lab
compute:
- architecture: amd64
  hyperthreading: Enabled
  name: worker
  replicas: 3
controlPlane:
  architecture: amd64
  hyperthreading: Enabled
  name: master
  replicas: 5
networking:
  clusterNetwork:
  - cidr: 10.128.0.0/14
    hostPrefix: 23
  machineNetwork:
  - cidr: 10.0.0.0/16
  networkType: OVNKubernetes
  serviceNetwork:
  - 172.30.0.0/16
platform:
  aws:
    region: us-east-2
    subnets:
    - subnet-079ac31e791746995
publish: Internal
additionalTrustBundlePolicy: Always

----

